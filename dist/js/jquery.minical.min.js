(function(){var l,a,s;a={offset:{x:0,y:5},inline:!(s={clear_link:function(){return $("<p />",{class:"minical_clear"}).append($("<a />",{href:"#",text:"clear date"}))},day:function(t){return $("<td />").data("minical_date",new Date(t)).addClass(l.getDayClass(t)).append($("<a />",{href:"#"}).text(t.getDate()))},dayHeader:function(){var t,i,e,a,n;for(e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t=$("<tr />"),a=0,n=e.length;a<n;a++)i=e[a],$("<th />").text(i).appendTo(t);return t},month:function(t){var i;return(i=$("<li />",{class:"minical_"+l.getMonthName(t).toLowerCase()})).html("<article> <header> <h1>"+l.getMonthName(t)+" "+t.getFullYear()+"</h1> <a href='#' class='minical_prev'></a> <a href='#' class='minical_next'></a> </header> <section> <table> <thead> <tr> </tr> </thead> <tbody> </tbody> </table> </section> </article>"),i.find("thead").append(this.dayHeader()),i}}),trigger:null,align_to_trigger:!0,initialize_with_date:!0,move_on_resize:!0,read_only:!0,show_clear_link:!(l={getMonthName:function(t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]},getDayClass:function(t){if(t)return"minical_day_"+[t.getMonth()+1,t.getDate(),t.getFullYear()].join("_")},getStartOfCalendarBlock:function(t){var i;return(i=new Date(t)).setDate(1),new Date(i.setDate(1-i.getDay()))}}),add_timezone_offset:!1,appendCalendarTo:function(){return $("body")},date_format:function(t){return[t.getMonth()+1,t.getDate(),t.getFullYear()].join("/")},from:null,to:null,date_changed:$.noop,month_drawn:$.noop,fireCallback:function(t){return this[t]&&this[t].apply(this.$el)},buildCalendarContainer:function(){var t;return t=$("<ul />",{id:"minical_calendar_"+this.id,class:"minical"}).data("minical",this),this.inline?t.addClass("minical-inline").insertAfter(this.$el):t.appendTo(this.appendCalendarTo.apply(this.$el))},render:function(t){var i,e,a,n,r;for(null==t&&(t=this.selected_day),i=s.month(t),!this.show_clear_link&&this.initialize_with_date||s.clear_link().insertAfter(i.find("table")),a=l.getStartOfCalendarBlock(t),this.from&&this.from>a&&i.find(".minical_prev").detach(),n=1;n<=6;++n){for(e=$("<tr />"),r=1;r<=7;++r)e.append(this.renderDay(a,t)),a.setDate(a.getDate()+1);e.find(".minical_day").length&&e.appendTo(i.find("tbody"))}return i.find("."+l.getDayClass(new Date)).addClass("minical_today"),this.to&&this.to<=new Date(i.find("td").last().data("minical_date"))&&i.find(".minical_next").detach(),this.$cal.empty().append(i),this.markSelectedDay(),this.fireCallback("month_drawn"),this.$cal},renderDay:function(t,i){var e,a,n;return e=s.day(t),a=t.getMonth(),n=i.getMonth(),(this.from&&t<this.from||this.to&&t>this.to)&&e.addClass("minical_disabled"),n<a||0===a&&11===n?e.addClass("minical_future_month"):a<n?e.addClass("minical_past_month"):e.addClass("minical_day")},highlightDay:function(t){var i,e;if(!(i=this.$cal.find("."+l.getDayClass(t))).hasClass("minical_disabled")&&!(this.to&&t>this.to||this.from&&t<this.from))return i.length?(e="minical_highlighted",this.$cal.find("."+e).removeClass(e),i.addClass(e)):(this.render(t),void this.highlightDay(t))},selectDay:function(t,i){var e;return e=i?"change.minical_external":"change.minical",this.selected_day=t,this.markSelectedDay(),this.$el.val(t?this.date_format(this.selected_day):"").trigger(e),this.fireCallback("date_changed")},markSelectedDay:function(){var t;return t="minical_selected",this.$cal.find("td").removeClass(t),this.$cal.find("."+l.getDayClass(this.selected_day)).addClass(t)},moveToDay:function(t,i){var e,a,n;return(e=this.$cal.find(".minical_highlighted")).length||(e=this.$cal.find(".minical_day").eq(0)),a=e.data("minical_date"),(n=new Date(a)).setDate(a.getDate()+t+7*i),this.highlightDay(n),!1},positionCalendar:function(){var t,i,e,a;return this.inline||(i=this.align_to_trigger?this.$trigger[this.offset_method]():this.$el[this.offset_method](),t=this.align_to_trigger?this.$trigger.outerHeight():this.$el.outerHeight(),a={left:i.left+this.offset.x+"px",top:t+i.top+this.offset.y+"px"},this.$cal.css(a),0<(e=this.$cal.width()+this.$cal[this.offset_method]().left-$(window).width())&&this.$cal.css("left",i.left-e-10)),this.$cal},clickDay:function(t){var i;return(i=$(t.target).closest("td")).hasClass("minical_disabled")||(this.selectDay(i.data("minical_date")),this.$cal.trigger("hide.minical")),!1},hoverDay:function(t){return this.highlightDay($(t.target).closest("td").data("minical_date"))},hoverOutDay:function(t){return this.$cal.find(".minical_highlighted").removeClass("minical_highlighted")},nextMonth:function(t){var i;return(i=new Date(this.$cal.find(".minical_day").eq(0).data("minical_date"))).setMonth(i.getMonth()+1),this.render(i),!1},prevMonth:function(t){var i;return(i=new Date(this.$cal.find(".minical_day").eq(0).data("minical_date"))).setMonth(i.getMonth()-1),this.render(i),!1},showCalendar:function(t){if($(".minical").not(this.$cal).trigger("hide.minical"),!this.$cal.is(":visible")&&!this.$el.is(":disabled"))return this.highlightDay(this.selected_day||this.detectInitialDate()),this.positionCalendar().show(),this.attachCalendarEvents(),t&&t.preventDefault()},hideCalendar:function(t){if(!this.inline)return this.$cal.hide(),this.detachCalendarEvents(),!1},attachCalendarEvents:function(){if(!this.inline)return this.detachCalendarEvents(),$(document).on("keydown.minical_"+this.id,$.proxy(this.keydown,this)).on("click.minical_"+this.id+" touchend.minical_"+this.id,$.proxy(this.outsideClick,this)),this.move_on_resize?$(window).on("resize.minical_"+this.id,$.proxy(this.positionCalendar,this)):void 0},detachCalendarEvents:function(){return $(document).off("keydown.minical_"+this.id).off("click.minical_"+this.id+" touchend.minical_"+this.id),$(window).off("resize.minical_"+this.id)},keydown:function(t){var i,e,a;return i=t.which,e={9:function(){return!0},13:function(){return a.$cal.find(".minical_highlighted a").click(),!1},37:function(){return a.moveToDay(-1,0)},38:function(){return a.moveToDay(0,-1)},39:function(){return a.moveToDay(1,0)},40:function(){return a.moveToDay(0,1)}},(a=this).checkToHideCalendar(),e[i]?e[i]():t.metaKey||t.ctrlKey?void 0:!a.read_only},preventKeystroke:function(t){return this.read_only},outsideClick:function(t){var i;return i=$(t.target),(this.$last_clicked=i).parent().is(".minical_clear")?(this.$el.minical("clear"),!1):!!(i.is(this.$el)||i.is(this.$trigger)||i.closest(".minical").length)||this.$cal.trigger("hide.minical")},checkToHideCalendar:function(){var t;return t=this,setTimeout(function(){if(!t.$el.add(t.$trigger).is(":focus"))return t.$cal.trigger("hide.minical")},50)},initTrigger:function(){return $.isFunction(this.trigger)?this.$trigger=$.proxy(this.trigger,this.$el)():(this.$trigger=this.$el.find(this.trigger),this.$trigger.length||(this.$trigger=this.$el.parent().find(this.trigger))),this.$trigger.length?this.$trigger.data("minical",this).on("focus.minical click.minical",(t=this,function(){return t.$cal.trigger("show.minical")})):(this.$trigger=$.noop,this.align_to_trigger=!1);var t},detectDataAttributeOptions:function(){var t,i,e,a,n,r;for(r=[],e=0,a=(n=["from","to"]).length;e<a;e++)i=n[e],(t=this.$el.attr("data-minical-"+i))&&/^\d+$/.test(t)?r.push(this[i]=new Date(+t)):r.push(void 0);return r},detectInitialDate:function(){var t,i;return t=this.$el.attr("data-minical-initial")||this.$el.val(),i=/^\d+$/.test(t)?t:t?Date.parse(t):(new Date).getTime(),i=parseInt(i)+(this.add_timezone_offset?60*(new Date).getTimezoneOffset()*1e3:0),new Date(i)},external:{clear:function(){var t;return t=this.data("minical"),this.trigger("hide.minical"),t.selectDay(!1)},destroy:function(){var t;return t=this.data("minical"),this.trigger("hide.minical"),t.$cal.remove(),t.$el.removeClass("minical_input").removeData("minical")},select:function(t){return this.data("minical").selectDay(t,!0)}},init:function(){var i,t;return this.id=$(".minical").length,(i=this).detectDataAttributeOptions(),this.$cal=this.buildCalendarContainer(),(this.$el.val()||this.initialize_with_date)&&this.selectDay(this.detectInitialDate()),this.offset_method=this.$cal.parent().is("body")?"offset":"position",this.initTrigger(),this.$el.addClass("minical_input"),this.$cal.on("click.minical","td a",$.proxy(this.clickDay,this)).on("mouseenter.minical","td a",$.proxy(this.hoverDay,this)).on("mouseleave.minical",$.proxy(this.hoverOutDay,this)).on("click.minical","a.minical_next",$.proxy(this.nextMonth,this)).on("click.minical","a.minical_prev",$.proxy(this.prevMonth,this)),this.inline?this.showCalendar():(this.$el.on("focus.minical click.minical",(t=this,function(){return t.$cal.trigger("show.minical")})).on("hide.minical",$.proxy(this.hideCalendar,this)).on("keydown.minical",function(t){return i.preventKeystroke.call(i,t)}),this.$cal.on("hide.minical",$.proxy(this.hideCalendar,this)).on("show.minical",$.proxy(this.showCalendar,this)))}},$.fn.minical=function(e){return this,e&&a.external[e]?a.external[e].apply(this,Array.prototype.slice.call(arguments,1)):this.each(function(){var t,i;return t=$(this),i=$.extend(!0,{$el:t},a,e),t.data("minical",i),i.init()})}}).call(this);